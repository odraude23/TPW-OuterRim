{% extends "layout.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h2>Admin Page</h2>

    <!-- Section for Products -->
    <h3>Products</h3>
    <form method="get" class="form-inline mb-3">
        <input type="text" name="product_search" placeholder="Search products..." class="form-control mr-2" value="{{ product_query }}">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
    <ul class="list-group mb-4">
        {% for product in products %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>
                    <strong>{{ product.name }}</strong> - Seller: {{ product.user.username }}
                </span>
                <span>
                    <form method="post" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="delete_product" value="{{ product.id }}">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                    <a href="{% url 'product_details' product.id %}" class="btn btn-info btn-sm">Open</a>
                </span>
            </li>
        {% empty %}
            <li class="list-group-item">No products found.</li>
        {% endfor %}
    </ul>

    <!-- Section for Users -->
    <h3>Users</h3>
    <form method="get" class="form-inline mb-3">
        <input type="text" name="user_search" placeholder="Search users..." class="form-control mr-2" value="{{ user_query }}">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
    <ul class="list-group mb-4">
        {% for user in users %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>
                    <strong>{{ user.name }}</strong> - Username: {{ user.username }} - Email: {{ user.email }}
                </span>
                <span>
                    <form method="post" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="delete_user" value="{{ user.id }}">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                    <a href="{% url 'user_detail' user.id %}" class="btn btn-info btn-sm">Open</a>
                </span>
            </li>
        {% empty %}
            <li class="list-group-item">No users found.</li>
        {% endfor %}
    </ul>

    <!-- Section for Comments (without Open button) -->
    <h3>Comments</h3>
    <form method="get" class="form-inline mb-3">
        <input type="text" name="comment_search" placeholder="Search comments..." class="form-control mr-2" value="{{ comment_query }}">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
    <ul class="list-group">
        {% for comment in comments %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>
                    <strong>{{ comment.user.username }}</strong> commented on <strong>{{ comment.seller.username }}</strong>: "{{ comment.text }}"
                </span>
                <span>
                    <form method="post" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="delete_comment" value="{{ comment.id }}">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </span>
            </li>
        {% empty %}
            <li class="list-group-item">No comments found.</li>
        {% endfor %}
    </ul>

    <h3>Orders</h3>
    <form method="get" class="form-inline mb-3">
        <input type="text" name="order_search" placeholder="Search orders..." class="form-control mr-2" value="{{ order_query }}">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
    <ul class="list-group">
        {% for order in orders %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>
                    <strong>{{ order.user.username }}</strong> ordered 
                    {% for product in order.products.all %}
                        <span>{{ product.name }}{% if not forloop.last %}, {% endif %}</span>
                    {% endfor %}
                    on {{ order.date }}.
                </span>
            </li>
        {% empty %}
            <li class="list-group-item">No orders found.</li>
        {% endfor %}
    </ul>
    </div>
{% endblock %}
